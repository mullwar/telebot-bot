const t = require("translatte");

const TRANSLATE_TO = "en";
const TRANSLATE_ICONS = {
    "ca": "ðŸ‡ªðŸ‡¸",
    "ar": "ðŸ‡¾ðŸ‡ª",
    "ps": "ðŸ‡¦ðŸ‡«",
    "uz": "ðŸ‡ºðŸ‡¿",
    "tk": "ðŸ‡¹ðŸ‡²",
    "en": "ðŸ‡¿ðŸ‡¼",
    "sq": "ðŸ‡½ðŸ‡°",
    "hy": "ðŸ‡¨ðŸ‡¾",
    "ru": "ðŸ‡·ðŸ‡º",
    "pt": "ðŸ‡¹ðŸ‡±",
    "es": "ðŸ‡»ðŸ‡ª",
    "gn": "ðŸ‡µðŸ‡¾",
    "sm": "ðŸ‡¼ðŸ‡¸",
    "de": "ðŸ‡±ðŸ‡º",
    "nl": "ðŸ‡¸ðŸ‡½",
    "pa": "ðŸ‡¨ðŸ‡¼",
    "sv": "ðŸ‡¸ðŸ‡ª",
    "az": "ðŸ‡¦ðŸ‡¿",
    "bs": "ðŸ‡²ðŸ‡ª",
    "hr": "ðŸ‡²ðŸ‡ª",
    "sr": "ðŸ‡½ðŸ‡°",
    "bn": "ðŸ‡§ðŸ‡©",
    "fr": "ðŸ‡¾ðŸ‡¹",
    "ff": "ðŸ‡¬ðŸ‡³",
    "bg": "ðŸ‡§ðŸ‡¬",
    "rn": "ðŸ‡§ðŸ‡®",
    "ms": "ðŸ‡¸ðŸ‡¬",
    "ay": "ðŸ‡§ðŸ‡´",
    "qu": "ðŸ‡§ðŸ‡´",
    "dz": "ðŸ‡§ðŸ‡¹",
    "no": "ðŸ‡¸ðŸ‡¯",
    "nb": "ðŸ‡³ðŸ‡´",
    "nn": "ðŸ‡³ðŸ‡´",
    "tn": "ðŸ‡¿ðŸ‡¦",
    "be": "ðŸ‡§ðŸ‡¾",
    "ln": "ðŸ‡¨ðŸ‡¬",
    "kg": "ðŸ‡¨ðŸ‡©",
    "sw": "ðŸ‡ºðŸ‡¬",
    "lu": "ðŸ‡¨ðŸ‡©",
    "sg": "ðŸ‡¨ðŸ‡«",
    "it": "ðŸ‡»ðŸ‡¦",
    "zh": "ðŸ‡¹ðŸ‡¼",
    "el": "ðŸ‡¬ðŸ‡·",
    "tr": "ðŸ‡¹ðŸ‡·",
    "cs": "ðŸ‡¨ðŸ‡¿",
    "sk": "ðŸ‡¸ðŸ‡°",
    "da": "ðŸ‡©ðŸ‡°",
    "et": "ðŸ‡ªðŸ‡ª",
    "ti": "ðŸ‡ªðŸ‡·",
    "eu": "ðŸ‡ªðŸ‡¸",
    "gl": "ðŸ‡ªðŸ‡¸",
    "oc": "ðŸ‡ªðŸ‡¸",
    "am": "ðŸ‡ªðŸ‡¹",
    "fi": "ðŸ‡«ðŸ‡®",
    "fj": "ðŸ‡«ðŸ‡¯",
    "hi": "ðŸ‡®ðŸ‡³",
    "ur": "ðŸ‡µðŸ‡°",
    "fo": "ðŸ‡«ðŸ‡´",
    "ka": "ðŸ‡¬ðŸ‡ª",
    "kl": "ðŸ‡¬ðŸ‡±",
    "ch": "ðŸ‡²ðŸ‡µ",
    "ht": "ðŸ‡­ðŸ‡¹",
    "hu": "ðŸ‡­ðŸ‡º",
    "id": "ðŸ‡®ðŸ‡©",
    "ga": "ðŸ‡®ðŸ‡ª",
    "he": "ðŸ‡®ðŸ‡±",
    "gv": "ðŸ‡®ðŸ‡²",
    "ku": "ðŸ‡®ðŸ‡¶",
    "fa": "ðŸ‡®ðŸ‡·",
    "is": "ðŸ‡®ðŸ‡¸",
    "ja": "ðŸ‡¯ðŸ‡µ",
    "ky": "ðŸ‡°ðŸ‡¬",
    "km": "ðŸ‡°ðŸ‡­",
    "ko": "ðŸ‡°ðŸ‡·",
    "kk": "ðŸ‡°ðŸ‡¿",
    "lo": "ðŸ‡±ðŸ‡¦",
    "si": "ðŸ‡±ðŸ‡°",
    "ta": "ðŸ‡¸ðŸ‡¬",
    "st": "ðŸ‡¿ðŸ‡¦",
    "lt": "ðŸ‡±ðŸ‡¹",
    "lb": "ðŸ‡±ðŸ‡º",
    "lv": "ðŸ‡±ðŸ‡»",
    "ro": "ðŸ‡·ðŸ‡´",
    "mg": "ðŸ‡²ðŸ‡¬",
    "mh": "ðŸ‡²ðŸ‡­",
    "mk": "ðŸ‡²ðŸ‡°",
    "my": "ðŸ‡²ðŸ‡²",
    "mn": "ðŸ‡²ðŸ‡³",
    "mt": "ðŸ‡²ðŸ‡¹",
    "dv": "ðŸ‡²ðŸ‡»",
    "ny": "ðŸ‡²ðŸ‡¼",
    "af": "ðŸ‡¿ðŸ‡¦",
    "ne": "ðŸ‡³ðŸ‡µ",
    "na": "ðŸ‡³ðŸ‡·",
    "mi": "ðŸ‡³ðŸ‡¿",
    "pl": "ðŸ‡µðŸ‡±",
    "rw": "ðŸ‡·ðŸ‡¼",
    "sl": "ðŸ‡¸ðŸ‡®",
    "so": "ðŸ‡¸ðŸ‡´",
    "ss": "ðŸ‡¿ðŸ‡¦",
    "th": "ðŸ‡¹ðŸ‡­",
    "tg": "ðŸ‡¹ðŸ‡¯",
    "to": "ðŸ‡¹ðŸ‡´",
    "uk": "ðŸ‡ºðŸ‡¦",
    "la": "ðŸ‡»ðŸ‡¦",
    "vi": "ðŸ‡»ðŸ‡³",
    "bi": "ðŸ‡»ðŸ‡º",
    "nr": "ðŸ‡¿ðŸ‡¦",
    "ts": "ðŸ‡¿ðŸ‡¦",
    "ve": "ðŸ‡¿ðŸ‡¦",
    "xh": "ðŸ‡¿ðŸ‡¦",
    "zu": "ðŸ‡¿ðŸ‡¦",
    "sn": "ðŸ‡¿ðŸ‡¼",
    "nd": "ðŸ‡¿ðŸ‡¼"
};

module.exports = {
    id: "telebot-auto-translator",
    name: "Auto Translator Plugin",
    version: "1.0.0",

    plugin(bot, config = {}) {
        const {translateTo} = config;

        function translate(value, translateTo = TRANSLATE_TO) {
            return t(value, {to: translateTo}).then(({text, from}) => {
                const iso = from.language.iso.toLowerCase();
                if (iso !== translateTo) {
                    const icon = TRANSLATE_ICONS[iso];
                    return [icon, text].filter(Boolean).join(" ");
                }
                return null;
            })
        }

        bot.on("text", (msg) => {
            const {
                message_id,
                text,
                chat: {
                    id: chat_id,
                    type
                }
            } = msg;

            if (!(["group", "supergroup"].includes(type))) return;

            return translate(text, translateTo).then((value) => {
                if (value) {
                    return bot.sendMessage(chat_id, value, {
                        reply_to_message_id: message_id,
                        disable_notification: true,
                        disable_web_page_preview: true
                    });
                }
            });
        });

    }
};